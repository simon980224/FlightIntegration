{% extends 'base.html' %}
{% block title %}航班查詢系統{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">查詢航班</h2>
    <form method="POST" action="/search">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="from_airport">出發地</label>
                <select class="form-select" id="from_airport" name="from_airport">
                    <option value="">不限</option>
                    {% for airport in airport_data %}
                        <option value="{{ airport['Airport_Id'] }}"
                            {% if request.form.get('from_airport') == airport['Airport_Id'] %}selected{% endif %}>
                            {{ airport['Airport_Name_ZH'] }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <label for="to_airport">目的地</label>
                <select class="form-select" id="to_airport" name="to_airport">
                    <option value="">不限</option>
                    {% for airport in airport_data %}
                        <option value="{{ airport['Airport_Id'] }}"
                            {% if request.form.get('to_airport') == airport['Airport_Id'] %}selected{% endif %}>
                            {{ airport['Airport_Name_ZH'] }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="departure_time">預計起飛時間</label>
                <input type="datetime-local" class="form-control" name="departure_time" id="departure_time"
                       value="{{ request.form.get('departure_time')|replace(' ', 'T') }}">
            </div>
            <div class="col-md-6">
                <label for="arrival_time">預計抵達時間</label>
                <input type="datetime-local" class="form-control" name="arrival_time" id="arrival_time"
                       value="{{ request.form.get('arrival_time')|replace(' ', 'T') }}">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="airline_id">航空公司</label>
                <select class="form-select" id="airline_id" name="airline_id">
                    <option value="">不限</option>
                    {% for airline in airline_data %}
                        <option value="{{ airline['Airline_Id'] }}"
                            {% if request.form.get('airline_id') == airline['Airline_Id'] %}selected{% endif %}>
                            {{ airline['Airline_Name_ZH'] }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="sort_by">排序依據</label>
                <select class="form-select" id="sort_by" name="sort_by">
                    <option value="">預設排序</option>
                    <option value="asc" {% if request.form.get('sort_by') == 'asc' %}selected{% endif %}>起飛時間（早→晚）</option>
                    <option value="desc" {% if request.form.get('sort_by') == 'desc' %}selected{% endif %}>起飛時間（晚→早）</option>
                </select>
            </div>
        </div>

        <div class="text-center">
            <button class="btn btn-primary" type="submit">查詢</button>
        </div>
    </form>

    {% if flights is defined %}
        <hr class="my-4">
        <h4>查詢結果：</h4>
        <p>共 {{ flights|length }} 筆航班</p>
        {% if flights %}
        <table class="table table-bordered mt-3">
            <thead class="table-light">
            <tr>
                <th>航空公司</th>
                <th>出發地</th>
                <th>目的地</th>
                <th>起飛時間</th>
                <th>抵達時間</th>
                <th>狀態</th>
            </tr>
            </thead>
            <tbody>
            {% for flight in flights %}
                <tr>
                    <td>{{ flight['Airline_Name_ZH'] }}</td>
                    <td>{{ flight['From_Airport'] }}</td>
                    <td>{{ flight['To_Airport'] }}</td>
                    <td>{{ flight['Scheduled_Departure_Time'] }}</td>
                    <td>{{ flight['Scheduled_Arrival_Time'] }}</td>
                    <td>{{ flight['Status'] }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
            <div class="alert alert-warning">查無符合條件的航班</div>
        {% endif %}
    {% endif %}
</div>
{% endblock %}
